---
layout: post
title: DBR的仿真实现
categories: [WSN]
tags:
- ns2
- Aqua-sim
- DBR
---


### 修改接口 ###

1. 修改UWSinkAgent.sendpkt，主要修改路由层包头的封装。将vbf改成dbr的包头
2. 修改Dbr.Recv，进一步封装包头。
3. 修改UWSinkAgent.recv，分析DBR的包头，进行一些统计分析。

具体修改后的代码，近期上传网盘

网上有关DBR的资源很少，自己目前初步实现的版本，相信可以给一起走夜路的同学提供点帮助。

### 算法实现 ###

*. TOA的实现

TOA需要通过时间戳来计算到达时间，乘以水声速度，就可以粗略计算距离。
最开始在DBR_Agent类中直接加入时间戳，通过与欧氏距离比较，相距很大。分析原因后，应该是MAC层冲撞等问题导致，回想起时间同步的一些经典思路，把时间戳打在应用层，确实存在问题。
把时间戳打在cmh中，在MAC层调用TxProcess进行转发时进行赋值，这样下来的效果要好很多，距离在50M以上的，基本和欧氏距离的误差在5%以内，但距离很小的时候，比如10以下，则可能差出2倍多。
娶了一些样本做回归，最后用一个简单的二次函数拟合，现在的结果，基本满足整体误差在3%以内。

*. EE-DBR的实现

这是我论文中的一个研究点，引入TOA的目的是为了EE（energy efficiency），思路和很简单，地理信息路由的经典思路，就是分支限界。我们发现，如下图所示

![图1](http://pic.yupoo.com/bitcsdby/DGt8nuEy/medish.jpg)

蓝色区域内点，地理位置一般，不是最优的转发路径，同时又可能在延迟转发阶段，不被最优的节点影响到，从而成为冗余多路转发的祸根。去掉这部分冗余转发，理论上可以大大降低网络能耗。

通过TOA加深度差，计算角度小于30度的节点不参与转发，经过第一轮仿真，结果如下图所示。

![图2](http://pic.yupoo.com/bitcsdby/DGtdgJtl/medish.jpg)

整体发包数量降低80%左右，且整体网络冲撞随节点密度增加不明显，也就是扩展性很好。

![图3](http://pic.yupoo.com/bitcsdby/DGtdfYtP/medish.jpg)

路由成功率虽然略有降低，但保持在95%左右，仍然是高成功率。

这是第一轮仿真的结果，后面还要继续斟酌修正。

这个点，可以作为milcom的主要内容，看一下评委的意见。

到此，NS2算是正式上手了，后续内容，要结合文章，多思考，多迭代。